<% view.child_node_views.each do |child_node_view| %>
  <% if child_node_view.visible_to_user? %>
    <%= content_tag :li,
                    :class => top_level_node ? 'sidebar-nav__section' : nil do %>
      <% if child_node_view.leaf_node? %>
        <%= link_to child_node_view.name,
                    Guide::Engine.routes.url_helpers.node_path(
                      :node_path => if node_path.present?
                        "#{node_path}/#{child_node_view.id}"
                      else
                        "#{child_node_view.id}"
                      end
                    ),
                    :class => child_node_view.active? ? 'is-active link' : 'link' %>
      <% else %>
        <% if top_level_node %>
          <div class="sidebar-nav__section-title">
            <%= link_to Guide::Engine.routes.url_helpers.node_path(child_node_view.id), :class => "link" do %>
              <h6 class="m0"><%= child_node_view.name %></h6>
            <% end %>
          </div>
          <%= link_to '', '#', :class => [
                        "sidebar-nav__section-expander link",
                        ('is-active' if child_node_view.active?),
                      ] %>
        <% else %>
          <%= link_to '#', :class => "sidebar-nav__header link" do %>
            <strong><%= child_node_view.name %></strong>
          <% end %>
        <% end %>

        <ul class="sidebar__sub-group p0">
          <%= render  'guide/common/navigation_node',
                      :node_path => if node_path.present?
                        "#{node_path}/#{child_node_view.id}"
                      else
                        "#{child_node_view.id}"
                      end,
                      :top_level_node => false,
                      :view => child_node_view %>
        </ul>
      <% end %>
    <% end %>
  <% end %>
<% end %>
